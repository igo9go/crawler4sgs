<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>三国杀官方正版_新三国杀全新起航_星火燎原重燃三国！</title>
</head>

<body>

    <div id="loadingDiv" style="position:absolute;top:50%;left:50%;margin-top:-366px;margin-left:-610px;width:1220px;height:732px;z-Index:-1;background:url('res/assets/htmlLoading/loadingBg.jpg')">
        <div style="position:absolute;top:585px;left:493px;width:234px;height:65px;background:url('res/assets/htmlLoading/loading.gif');"></div>
    </div>

    <div id="bgDiv" style="position:absolute;top:0px;left:0px;width:100%;height:100%;z-Index:-2;overflow:hidden">
        <img style="width:100%;height:100%;" src="res/assets/gameBg.png" />
    </div>

    <script>
        function hideHtmlLoading() {
            var loadingDiv = document.getElementById("loadingDiv");
            if (loadingDiv)
                loadingDiv.style.display = "none";
        }
    </script>

    <script type="text/javascript">
        //设置同域
        document.domain = "sanguosha.com";

        function cefVersion() { //获取微端版本号
            if (typeof cefBrowserVersion == "function") {
                return cefBrowserVersion();
            } else {
                return "";
            }
        }

        function GetRequest() {
            var url = location.search; //获取url中"?"符后的字串 
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = decodeURI(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }

        // ReqObj实例
        // {ticket:'',sign:'',channel_id:100}
        var ReqObj = GetRequest();

        if (window.history && window.history.replaceState) {
            var url = (location.href.replace(location.search, ""));
            console.log(url)
            window.history.replaceState(null, null, url);
        }
        if (!ReqObj.ticket && !ReqObj.token) {
            window.location.replace("http://web.sanguosha.com");
        }
        if (!ReqObj.channel_id) {
            ReqObj.channel_id = 100;
        }

        window.onerror = function(errorMessage, scriptURI, lineNumber, columnNumber, errorObj) {
            var info = "错误信息：" + errorMessage +
                "出错文件：" + scriptURI +
                "出错行号：" + lineNumber +
                "出错列号：" + columnNumber +
                "错误堆栈：" + (errorObj ? errorObj.stack : "");
            // alert(info);
            // ClientLog.ReportError(info);

            if (window.LogManager) {
                LogManager.GetInstance().SendErrorLog(info);
            }
        };

        function updateBgSize(width, height) {
            var bgDiv = document.getElementById("bgDiv");
            if (bgDiv) {
                bgDiv.style.width = width + "px";
                bgDiv.style.height = height + "px";
            }
        }

        var isIE = !!window.ActiveXObject || "ActiveXObject" in window;

        var now = new Date().getTime();
        localStorage.setItem('sgs1', now);

        function checkCanUseWebGL() {
            var canUseWebGL = false;
            try {
                var canvas = window.document.createElement("canvas");
                canUseWebGL = !!window["WebGLRenderingContext"] && !!(canvas.getContext("webgl") || canvas.getContext("experimental-webgl"));
            } catch (e) {
                canUseWebGL = false;
            }
            return canUseWebGL;
        }

        if (!checkCanUseWebGL()) //不支持webgl
        {
            if (ReqObj && ReqObj.channel_id) {
                if (ReqObj.channel_id == 1001) { //4399提示微端下载
                    window.location.href = "http://lyapi.sanguosha.com/4399/browser/low.html";
                }
            }
        }
    </script>
    <!--核心包，封装了显示对象渲染，事件，时间管理，时间轴动画，缓动，消息交互,socket，本地存储，鼠标触摸，声音，加载，颜色滤镜，位图字体等-->
    <!--<script type="text/javascript" src="libs/min/laya.core.min.js?v=1.7.19.1_2beta"></script>-->
    <!--封装了webgl渲染管线，如果使用webgl渲染，可以在初始化时调用Laya.init(1000,800,laya.webgl.WebGL);-->
    <!--<script type="text/javascript" src="libs/min/laya.webgl.min.js?v=1.7.19.1_2beta"></script>-->
    <!--是动画模块，包含了swf动画，骨骼动画等-->
    <!--<script type="text/javascript" src="libs/min/laya.ani.min.js?v=1.7.19.1_2beta"></script>-->
    <!--包含更多webgl滤镜，比如外发光，阴影，模糊以及更多-->
    <!--<script type="text/javascript" src="libs/min/laya.filter.min.js?v=1.7.19.1_2beta"></script>-->
    <!--封装了html动态排版功能-->
    <!--<script type="text/javascript" src="libs/min/laya.html.min.js?v=1.7.19.1_2beta"></script>-->
    <!--粒子类库-->
    <!--<script type="text/javascript" src="libs/min/laya.particle.min.js?v=1.7.19.1_2beta"></script>-->
    <!--提供tileMap解析支持-->
    <!--<script type="text/javascript" src="libs/min/laya.tiledmap.min.js?v=1.7.19.1_2beta"></script>-->
    <!--提供了制作UI的各种组件实现-->
    <!--<script type="text/javascript" src="libs/min/laya.ui.min.js?v=1.7.19.1_2beta"></script>-->
    <!--引擎扩展-->
    <!--<script type="text/javascript" src="libs/min/laya.expand.min.js"></script>-->

    <script type="text/javascript" src="libs/min/jszip.min.js"></script>
    <script type="text/javascript" src="libs/min/jszip-utils.min.js"></script>
    <!--<script type="text/javascript" src="libs/crypto-js.js"></script>-->
    <!--<script type="text/javascript" src="libs/encoding.js"></script>-->
    <!--<script type="text/javascript" src="libs/long.js"></script>-->
    <script type="text/javascript" src="libs/bytebuffer.js"></script>
    <!--<script type="text/javascript" src="libs/protobuf-mininal.js"></script>-->
    <script type="text/javascript" src="libs/protobuf.js"></script>
    <script type="text/javascript" src="libs/aes.js"></script>
    <script type="text/javascript" src="libs/worker.js"></script>
    <script type="text/javascript" src="libs/FileSaver.js"></script>
    <script type="text/javascript" src="libs/min/md5.min.js"></script>
    <script type="text/javascript" src="libs/min/gunzip.min.js"></script>
    <script type="text/javascript" src="libs/min/jquery.min.js"></script>
    <script type="text/javascript" src="libs/min/domparserinone.min.js"></script>
    <!-- 物理引擎matter.js -->
    <!--用户自定义顺序文件添加到这里-->
    <!--jsfile--Custom-->
    <script type="text/javascript" src="libs/clipboard.js"></script>
    <!--<script type="text/javascript" src="libs/proto_data.js"></script>-->
    <!--jsfile--Custom-->
    <!--自定义的js(src文件夹下)文件自动添加到下面jsfile模块标签里面里-->
    <!--删除标签，ide不会自动添加js文件，请谨慎操作-->

    <!--启动类添加到这里-->
    <!--<script type="text/javascript" src="main.min.js?v=2018121401"></script>-->

    <script>
        //定义加载zip文件的方法
        function loadZip(url, callBack) {
            var fileDatas = [];
            var index = 0;

            JSZipUtils.getBinaryContent(url, function(err, zipData) {
                if (err) throw err;
                console.log("加载zip : " + url);

                JSZip.loadAsync(zipData).then(function(zip) {
                    fileDatas = [];

                    for (var fileName in zip.files) {
                        var data = zip.file(fileName).async("string");
                        if (fileName == "laya.core.min.js") {
                            fileDatas.splice(0, 0, {
                                name: fileName,
                                data: data
                            });
                        } else {
                            fileDatas.push({
                                name: fileName,
                                data: data
                            });
                        }
                    }
                    if (fileDatas.length) {
                        index = 0;
                        parseZipFile(fileDatas[index], parseZipFileEnd);
                    }
                });
            });

            function parseZipFileEnd() {
                index++;
                if (index < fileDatas.length) {
                    parseZipFile(fileDatas[index], parseZipFileEnd);
                } else {
                    callBack();
                }
            }
        }

        //解析zip文件，并转换为javascript脚本运行
        function parseZipFile(fileData, callBack) {
            fileData.data.then(function(text) {
                addScript(text);
                console.log("解析js : " + fileData.name);
                callBack();
            });
        }

        //使用document创建javascript脚本
        function addScript(text) {
            var script = document.createElement('script');
            script.setAttribute('type', 'text/javascript');
            script.text = text;
            document.body.appendChild(script);
            document.body.removeChild(script);
        }

        /// 加载引擎库
        loadZip("libs/min/laya.sgs?v=1.7.19.1_2beta", function() {
            console.log("Laya代码解析完成");

            loadZip("sgsGame.sgs?v=2018121401", function() {
                console.log("main.min.js代码解析完成");

                setGameData();
            });
        });

        function setGameData() {

            if (window.GameMain) {
                GameMain.BgComplete();
            }

            if (window.AccountInfo) {
                AccountInfo.SetRequestInfo(ReqObj);
                var wdVersion = cefVersion();
                if (wdVersion != "") { //微端
                    AccountInfo.WDChannel(wdVersion);
                }
            }
        }
    </script>

</body>

<div id="iframeCon">
</div>


<div id="btnDiv" style="z-index: 100001;position:absolute;display:none;transform-origin: top left;	-ms-transform-origin: top left;	-webkit-transform-origin:top left;	-moz-transform-origin:top left;-o-transform-origin:top left;">
    <button id="copyBtn" class="btn" style="width:76px;height:26px;opacity:0.01;cursor:pointer;" data-clipboard-text="1"></button>
</div>

<div id="inputDiv" style="z-index: 100002;position:absolute;display:none;transform-origin: top left;-ms-transform-origin: top left;	-webkit-transform-origin:top left;	-moz-transform-origin:top left;-o-transform-origin:top left;">
    <a href="javascript:;" class="file"><input id="inputFile" type="file" onchange="fileChange(this);" accept=".sgs" />播放本地录像</a>
</div>


<!--<div id="dobest_login_app"></div>-->
<script>
    if (window && cefVersion() == "") {
        window.onbeforeunload = function() {
            return '下载并使用微端登录新三国杀，可以领取专属武将张宝';
        }
    }

    window.onload = function() {
        var span = document.createElement("span");
        // 这几个字母和符号宽度比较容易变化
        span.innerHTML = "这是一段测试字";
        // 设置为不可见，但可以测量宽度
        span.style.visibility = "hidden";
        // 字体大小为 500px，如果宽度变化比较容易区分
        span.style.fontSize = "500px";
        // 设置字体
        span.style.fontFamily = "Arial";
        // 添加到页面
        document.body.appendChild(span);
        loadFont("fzbw", span);
    };

    function loadFont(font, span) {
        // 获取宽度
        var width_now = span.offsetHeight;
        var now = (new Date()).getTime();
        span.style.fontFamily = font;
        // 每 0.05 秒检查一次是否加载
        var interval_check = setInterval(function() {
            // 宽度变化，说明字体被加载
            if (span.offsetHeight != width_now) {
                clearInterval(interval_check);
                window.fontLoaded = true;
                if (window.GameMain) {
                    GameMain.EnterLoginScene();
                }
                // 设置字体为
                // ele.style.fontFamily = font;
                // 移除 span
                document.body.removeChild(span);
                span = null;
            }
        }, 50);
    }


    function fileChange(input) {
        var file = input.files[0];
        if (!file) {
            return;
        }
        var reader = new FileReader();
        reader.onload = function(e) {
            if (window.GameReplayManager) {
                window.GameReplayManager.PlayLocalRecord(reader.result);
                input.value = ''
            }
        }
        reader.readAsArrayBuffer(file);
    }

    //拷贝文本到剪贴板
    var copyCallBack;

    // function copyToClipboard() {
    (function() {
        var copyBtn = document.getElementById("copyBtn");
        var clipboard = new ClipboardJS(copyBtn);
        clipboard.on('success', function(e) {
            console.log(e);
            if (copyCallBack) {
                copyCallBack(true);
            }
        });

        clipboard.on('error', function(e) {
            console.log('Trigger:', e.trigger);
            if (copyCallBack) {
                copyCallBack(false);
            }
        });
    })();


    window.showCopyBtn = function(obj) {
        if (obj) {
            var btnDiv = document.getElementById("btnDiv");
            btnDiv.style.display = "block";
            btnDiv.style.transform = "scale(" + obj.scale + ")";
            btnDiv.style.mozTransform = "scale(" + obj.scale + ")";
            btnDiv.style.webkitTransform = "scale(" + obj.scale + ")";
            btnDiv.style.OTransform = "scale(" + obj.scale + ")";
            btnDiv.style.msTransform = "scale(" + obj.scale + ")";

            btnDiv.style.left = obj.left + "px";
            btnDiv.style.top = obj.top + "px";
            var btn = document.getElementById("copyBtn");
            btn.setAttribute("data-clipboard-text", obj.nameTxt);
            copyCallBack = obj.callBack;
        }
    }

    window.hideCopyBtn = function() {
        document.getElementById("btnDiv").style.display = "none";
    }


    window.showInputFile = function(obj) {
        if (obj) {
            var inputDiv = document.getElementById("inputDiv");
            inputDiv.style.display = "block";
            inputDiv.style.transform = "scale(" + obj.scale + ")";
            inputDiv.style.mozTransform = "scale(" + obj.scale + ")";
            inputDiv.style.webkitTransform = "scale(" + obj.scale + ")";
            inputDiv.style.OTransform = "scale(" + obj.scale + ")";
            inputDiv.style.msTransform = "scale(" + obj.scale + ")";

            inputDiv.style.left = obj.left + "px";
            inputDiv.style.top = obj.top + "px";
        }

    }

    window.hideInputFile = function() {
        document.getElementById("inputDiv").style.display = "none";
    }

    function callIFrame(wdt, het, url, modal, type, closeBtn) {
        var sgs_wd_bton = '';
        if (closeBtn == 'nom') {
            sgs_wd_bton = '<div style="position:absolute;top:10px;right:10px;"><a href="javascript:;" onclick="closeIFrame(' + "'" + type + "'" + ');return false;" style="float:left;width:19px;height:20px;overflow: hidden;text-indent:-9999px;cursor:pointer;background:url(images/close1.png) no-repeat 0 0;">[关闭]</a></div>';
        } else if (closeBtn == 'def') {
            sgs_wd_bton = '<div style="position:absolute;top:10px;right:10px;"><a href="javascript:;" onclick="closeIFrame(' + "'" + type + "'" + ');return false;">[关闭]</a></div>';
        }
        var top = Math.round(het / 2);
        if (window.innerHeight / 2 < top) {
            top = window.innerHeight / 2;
        }
        var sgs_wd_body = '<div style="position:absolute;font-size:12px;top:50%;left:50%;margin-top:-' + top + 'px;margin-left:-' + Math.round(wdt / 2) + 'px;width:' + wdt + 'px;height:' + het + 'px;z-index:9000;"><iframe width="100%" height="100%" frameborder="no" scrolling="no" style="background-color:#fff;" src="' + url + '"></iframe>' + sgs_wd_bton + '</div>';
        if (window.external.mxProductName) {
            window.open(url, "sgs_windows");
        } else if (modal) {
            document.getElementById("iframeCon").innerHTML = '<div style="position:absolute;left:0px;top:0px;width:100%;height:100%;background:rgba(0,0,0,0.5)">' + sgs_wd_body + '</div>';
        } else {
            document.getElementById("iframeCon").innerHTML = sgs_wd_body;
        }
    }

    function closeIFrame(type) {
        document.getElementById("iframeCon").innerHTML = '';
        if (type == "pay") {
            ChannelUtils.PayClosed();
        }
    }

    function callLinkImage(wdt, het, imageUrl, linkUrl, modal, closeBtn) {
        var sgs_wd_bton = '';
        if (closeBtn == 'nom') {
            sgs_wd_bton = '<div style="position:absolute;top:10px;right:10px;"><a href="javascript:;" onclick="closeLinkImage();return false;" style="float:left;width:19px;height:20px;overflow: hidden;text-indent:-9999px;cursor:pointer;background:url(images/close1.png) no-repeat 0 0;">[关闭]</a></div>';
        } else if (closeBtn == 'def') {
            sgs_wd_bton = '<div style="position:absolute;top:10px;right:10px;"><a href="javascript:;" onclick="closeLinkImage();return false;">[关闭]</a></div>';
        }
        var sgs_wd_body = '<div style="position:absolute;font-size:12px;top:50%;left:50%;margin-top:-' + Math.round(het / 2) + 'px;margin-left:-' + Math.round(wdt / 2) + 'px;width:' + wdt + 'px;height:' + het + 'px;z-index:9000;overflow:hidden;"><a href="javascript:;" onclick="linkImageClick(' + "'" + linkUrl + "'" + ');return false;"><img width="100%" height="100%" frameborder="no" scrolling="no" style="background-color:#fff;" src="' + imageUrl + '"/></a>' + sgs_wd_bton + '</div>';
        if (window.external && window.external.mxProductName) {
            window.open(linkUrl, "sgs_windows");
        } else if (modal) {
            document.getElementById("iframeCon").innerHTML = '<div style="position:absolute;left:0px;top:0px;width:100%;height:100%;background:rgba(0,0,0,0.5)">' + sgs_wd_body + '</div>';
        } else {
            document.getElementById("iframeCon").innerHTML = sgs_wd_body;
        }
    }

    function closeLinkImage() {
        document.getElementById("iframeCon").innerHTML = '';
    }

    function linkImageClick(linkUrl) {
        window.open(linkUrl);
        document.getElementById("iframeCon").innerHTML = '';
    }

    function jsonpLogin(options) {
        var url = options.url;
        var data = options.data;

        var oBody = document.getElementsByTagName('body')[0];
        var oScript = document.createElement('script');
        oScript.setAttribute('src', url + '?' + format(data));
        oBody.appendChild(oScript);
    }

    function format(data) {
        var str = '';
        var arr = [];
        for (var p in data) {
            str = encodeURIComponent(p) + '=' + encodeURIComponent(data[p]);
            arr.push(str);
        }
        return arr.join("&") + "&_=" + new Date().getTime();
    }

    // 发送请求
    function sendAjax(obj) {
        if (!obj) {
            return;
        }
        $.ajax({
            url: obj.url,
            data: obj.data,
            type: obj.method || "get",
            dataType: obj.responseType || "text",
            contentType: obj.contentType || "application/x-www-form-urlencoded",
            processData: obj.processData,
            success: function(result) {
                console.log(result);
                if (obj.callback) {
                    obj.callback(result);
                }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                console.log(errorThrown);
            },
            complete: function(XMLHttpRequest, textStatus) {
                console.log(textStatus);
            }
        })
    }
</script>

</html>